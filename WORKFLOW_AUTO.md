# WORKFLOW_AUTO.md

> 用途：会话启动、压缩恢复、模型切换后的自动执行清单。
> 原则：先恢复上下文，再执行任务；先检查状态，再对外输出。

## 1) 每次会话启动（必做）

1. 读取以下文件：
   - `SOUL.md`
   - `USER.md`
   - `memory/今天.md`
   - `memory/昨天.md`（若存在）
   - 主会话时再读：`MEMORY.md`
2. 读取本文件（`WORKFLOW_AUTO.md`）。
3. 输出前确认当前模型与时间（用 `session_status`）。

---

## 2) 压缩/上下文重置后（必做）

当出现“Post-Compaction Audit”或上下文被压缩后：

1. 立即补读：
   - `WORKFLOW_AUTO.md`
   - `memory/今天.md`
2. 用一句话在内部确认：
   - 已恢复流程规则
   - 已恢复当日上下文
3. 再继续执行用户请求。

---

## 3) 模型切换流程（标准）

当用户要求切换模型：

1. 执行切换（优先别名）：
   - `gpt` → `openai-codex/gpt-5.3-codex`
   - `deepseek` / `deepseek-r1`
2. 立刻 `session_status` 复核：
   - 当前模型
   - 是否已生效
3. 若未生效：
   - 重试一次
   - 再查日志（仅报告关键错误）
4. 给用户回复：
   - 成功/失败
   - 当前生效模型
   - 若失败给出下一步。

---

## 4) 日志检查最小集

当用户问“有没报错”：

1. 先看会话状态：`session_status`
2. 再看网关错误日志末尾（关键行即可）
3. 报告时只说三类：
   - 与问题直接相关的错误
   - 无关但会影响运行的错误
   - 可忽略的提示信息

不贴整段大日志，不泄露敏感内容。

---

## 5) 定时任务/自动化项目（HotNews）

与新闻站点相关任务，默认检查：

1. 脚本路径：`scripts/update_three_perspective_news.py`
2. 数据输出：`web_pages/hotnews/data/news.json`
3. 站点：`https://gosleep2018.github.io/web/hotnews/`
4. 若抓取异常：
   - 先验证 RSS 源可达
   - 再判断是否源站停更/失效
   - 最后再改代码

---

## 6) 沟通风格

- 面向 Boss：直接、执行型、先结论后细节。
- 遇到失败：
  - 先给结论
  - 再给原因
  - 最后给可执行修复方案
- 不说空话，不兜圈。

---

## 7) 变更落盘规则

发生以下情况时，必须写入记忆文件：

1. 流程或策略被明确修改
2. 关键配置变更（模型、cron、数据源）
3. 一次性经验可复用（成功/失败方法论）

落盘位置：
- 当日细节：`memory/YYYY-MM-DD.md`
- 长期沉淀：`MEMORY.md`

---

## 8) 快速自检（回复前10秒）

- [ ] 是否已读本文件与今日记忆？
- [ ] 当前模型是否与用户预期一致？
- [ ] 回答是否先给结论？
- [ ] 是否给了下一步可执行动作？
