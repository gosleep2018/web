<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HotNewsï½œå››æ èœå•ç‰ˆ</title>
  <style>
    :root{--bg:#0b1220;--panel:#121a2a;--line:#253148;--text:#e8eefc;--muted:#97a3bd;--pri:#3b82f6;--pri2:#1d4ed8;--soft:#0f1727}
    *{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,#0a1222,#0a1020);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",sans-serif}
    .wrap{max-width:1200px;margin:0 auto;padding:18px}
    .top{display:flex;justify-content:space-between;align-items:end;gap:10px;flex-wrap:wrap}
    h1{margin:0;font-size:30px;letter-spacing:.2px}
    .meta{color:var(--muted);font-size:13px}
    .menu{display:grid;grid-template-columns:repeat(4,minmax(120px,1fr));gap:10px;margin:16px 0}
    .tab{border:1px solid var(--line);background:var(--panel);color:var(--text);padding:12px 10px;border-radius:12px;cursor:pointer;font-weight:700}
    .tab.active{background:linear-gradient(180deg,var(--pri),var(--pri2));border-color:#4f8dff}
    .panel{display:none;background:rgba(16,24,40,.8);border:1px solid var(--line);border-radius:14px;padding:14px}
    .panel.active{display:block}
    .list{display:grid;grid-template-columns:1fr;gap:10px}
    .item{background:var(--soft);border:1px solid var(--line);border-radius:12px;padding:10px}
    .zh a{color:#dbeafe;text-decoration:none} .zh a:hover{text-decoration:underline}
    .en{color:#9cc3ff;font-size:13px;line-height:1.35;margin-top:5px}
    .btn{margin-top:8px;background:var(--pri);color:#fff;border:none;padding:6px 9px;border-radius:8px;cursor:pointer;font-size:12px}
    .btn:hover{background:var(--pri2)}
    .triCard{background:var(--soft);border:1px solid var(--line);border-radius:12px;padding:12px;margin-bottom:10px}
    .event{font-weight:700} .event .en{display:block}
    .triGrid{display:grid;grid-template-columns:repeat(3,minmax(220px,1fr));gap:10px;margin-top:8px}
    .col{border:1px solid var(--line);border-radius:10px;padding:10px;background:#0d1628}
    .col h4{margin:0 0 6px;font-size:14px;color:#c3d7ff}
    .insight{margin-top:10px;padding:10px;border-radius:10px;background:#0a1c35;border:1px solid #1e3a63;font-size:14px;line-height:1.5}
    @media (max-width:900px){.menu{grid-template-columns:repeat(2,1fr)}.triGrid{grid-template-columns:1fr}}
  </style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <h1>HotNews Â· å››æ èœå•</h1>
    <div class="meta" id="meta">åŠ è½½ä¸­...</div>
  </div>

  <div class="menu">
    <button class="tab active" data-tab="cn">1ã€ä¸­å›½</button>
    <button class="tab" data-tab="west">2ã€æ¬§ç¾</button>
    <button class="tab" data-tab="islam">3ã€ä¼Šæ–¯å…°</button>
    <button class="tab" data-tab="tri">4ã€ä¸‰æ–¹è§†è§’</button>
  </div>

  <section id="panel-cn" class="panel active"><div class="list" id="list-cn"></div></section>
  <section id="panel-west" class="panel"><div class="list" id="list-west"></div></section>
  <section id="panel-islam" class="panel"><div class="list" id="list-islam"></div></section>
  <section id="panel-tri" class="panel"><div id="list-tri"></div></section>
</div>

<script>
const AZURE_TTS_BASE='https://web-x0ya.onrender.com';

async function speakAzure(text){
  const q=encodeURIComponent(text); const voice=encodeURIComponent('en-US-JennyNeural');
  const r=await fetch(`${AZURE_TTS_BASE}/tts?text=${q}&voice=${voice}`); if(!r.ok) throw new Error('tts '+r.status);
  const b=await r.blob(); if(!b||b.size<1024) throw new Error('empty audio');
  const a=new Audio(URL.createObjectURL(b)); await a.play();
}
function speakFallback(text){ if(!('speechSynthesis' in window)) return; const u=new SpeechSynthesisUtterance(text); u.lang='en-US'; window.speechSynthesis.speak(u); }
window.readItem=async (zh,en)=>{const t=`Chinese: ${zh}. English: ${en}.`; try{await speakAzure(t)}catch(e){speakFallback(t)}}

function newsItem(it){
  const zh=it.title_zh||it.title||''; const en=it.title_en||it.title||'';
  return `<div class="item"><div class="zh"><a href="${it.link}" target="_blank" rel="noreferrer">${zh}</a></div><div class="en">${en}</div><button class="btn" onclick="readItem(${JSON.stringify(zh).replace(/"/g,'&quot;')},${JSON.stringify(en).replace(/"/g,'&quot;')})">ğŸ”Š è¯»ZH/EN</button></div>`;
}

function triCol(title,item){
  if(!item) return `<div class="col"><h4>${title}</h4><div class="en">æš‚æ—  / N/A</div></div>`;
  const zh=item.title_zh||item.title||''; const en=item.title_en||item.title||'';
  return `<div class="col"><h4>${title}</h4><div class="zh"><a href="${item.link}" target="_blank">${zh}</a></div><div class="en">${en}</div></div>`;
}

function switchTab(name){
  document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active',t.dataset.tab===name));
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.getElementById('panel-'+name).classList.add('active');
}

document.querySelectorAll('.tab').forEach(btn=>btn.onclick=()=>switchTab(btn.dataset.tab));

async function load(){
  const r=await fetch('./data/news.json?_='+Date.now());
  const d=await r.json();
  document.getElementById('meta').textContent=`æœ€åæ›´æ–° / Last update: ${d.generated_at}ï¼ˆæ¯æ—¥08:00è‡ªåŠ¨æ›´æ–°ï¼‰`;

  document.getElementById('list-cn').innerHTML=(d.sources?.['ä¸­å›½']||[]).slice(0,12).map(newsItem).join('');
  document.getElementById('list-west').innerHTML=(d.sources?.['ç¾å›½ï¼ˆæ¬§ç¾åª’ä½“ï¼‰']||[]).slice(0,12).map(newsItem).join('');
  document.getElementById('list-islam').innerHTML=(d.sources?.['ä¼Šæ–¯å…°ï¼ˆåŠå²›ç­‰ï¼‰']||[]).slice(0,12).map(newsItem).join('');

  const tri=(d.triangle||[]).map((e,i)=>`
    <div class="triCard">
      <div class="event">äº‹ä»¶ ${i+1}ï¼š${e.event_hint_zh||e.event_hint||''}<span class="en">${e.event_hint_en||e.event_hint||''}</span></div>
      <div class="triGrid">
        ${triCol('ä¸­å›½è§†è§’ / China',e['ä¸­å›½'])}
        ${triCol('æ¬§ç¾è§†è§’ / Western',e['ç¾å›½'])}
        ${triCol('ä¼Šæ–¯å…°è§†è§’ / Islamic',e['ä¼Šæ–¯å…°'])}
      </div>
      <div class="insight"><b>æˆ‘çš„çœ‹æ³• / My viewï¼š</b>${e.my_view||''}<br/><b>æ€»ç»“ / Summaryï¼š</b>${e.summary||''}</div>
    </div>
  `).join('');
  document.getElementById('list-tri').innerHTML=tri||'<div class="item">æš‚æ— å¯å¯¹æ¯”äº‹ä»¶</div>';
}

load().catch(e=>document.getElementById('meta').textContent='åŠ è½½å¤±è´¥ / Load failed: '+e.message);
</script>
</body>
</html>
