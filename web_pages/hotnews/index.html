<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HotNewsï½œåŒä¸€äº‹ä»¶ä¸‰æ–¹è§†è§’ / 3-View Comparison</title>
  <style>
    body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",sans-serif; margin:0; padding:22px; background:#0b1220; color:#e5e7eb; }
    h1 { margin:0 0 8px; font-size:28px; }
    .meta { color:#9ca3af; margin-bottom:16px; }
    .card { background:#111827; border:1px solid #1f2937; border-radius:14px; padding:14px; margin-bottom:14px; }
    .event { font-weight:700; margin-bottom:10px; color:#f9fafb; }
    .event .en { display:block; margin-top:4px; color:#93c5fd; font-size:13px; font-weight:500; }
    .toolbar { display:flex; gap:8px; margin:8px 0 10px; }
    .btn { background:#1d4ed8; color:#fff; border:none; border-radius:8px; padding:6px 10px; font-size:13px; cursor:pointer; }
    .btn:hover { background:#1e40af; }
    .grid { display:grid; grid-template-columns: repeat(3,minmax(220px,1fr)); gap:10px; }
    .col { background:#0f172a; border:1px solid #1e293b; border-radius:10px; padding:10px; }
    .col h3 { margin:0 0 6px; font-size:15px; color:#c7d2fe; }
    .empty { color:#64748b; font-size:13px; }
    a { color:#93c5fd; text-decoration:none; }
    a:hover { text-decoration:underline; }
    @media (max-width:900px){ .grid{grid-template-columns:1fr;} }
  </style>
</head>
<body>
  <h1>HotNewsï¼šåŒä¸€æ–°é—»äº‹ä»¶ä¸‰æ–¹è§‚ç‚¹å¯¹æ¯” / Same Event, 3 Perspectives</h1>
  <div class="meta" id="meta">åŠ è½½ä¸­... / Loading...</div>
  <div class="toolbar" style="margin-bottom:14px;">
    <button id="readAllBtn" class="btn">ğŸ”Š æœ—è¯»ä»Šæ—¥å…¨éƒ¨ / Read All Today</button>
  </div>
  <div id="list"></div>

  <script>
    function renderItem(container, title, item){
      const col = document.createElement('div');
      col.className = 'col';
      col.innerHTML = `<h3>${title}</h3>`;
      if(item && item.link){
        const p = document.createElement('div');
        const zh = item.title_zh || item.title || '';
        const en = item.title_en || item.title || '';
        p.innerHTML = `
          <div><a href="${item.link}" target="_blank" rel="noreferrer">${zh}</a></div>
          <div style="margin-top:6px;color:#93c5fd;font-size:13px;line-height:1.35;">${en}</div>
        `;
        col.appendChild(p);
      }else{
        const e = document.createElement('div');
        e.className = 'empty';
        e.textContent = 'æš‚æ— åŒ¹é…è§‚ç‚¹ / No matched perspective';
        col.appendChild(e);
      }
      container.appendChild(col);
    }

    const AZURE_TTS_ENDPOINT = 'https://web-x0ya.onrender.com/tts';

    async function speakWithAzure(text){
      const resp = await fetch(AZURE_TTS_ENDPOINT, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text })
      });
      if(!resp.ok) throw new Error('TTS request failed');
      const blob = await resp.blob();
      const url = URL.createObjectURL(blob);
      const audio = new Audio(url);
      audio.play();
    }

    function speakFallback(text){
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'zh-CN';
      window.speechSynthesis.speak(u);
    }

    let __hotnewsData = null;

    async function load(){
      const res = await fetch('./data/news.json?_=' + Date.now());
      const data = await res.json();
      __hotnewsData = data;
      document.getElementById('meta').textContent = `æœ€åæ›´æ–° / Last update: ${data.generated_at}ï¼ˆæ¯æ—¥ 08:00 è‡ªåŠ¨æ›´æ–° / Auto update at 08:00 dailyï¼‰`;

      const list = document.getElementById('list');
      list.innerHTML = '';

      const comps = data.comparisons || [];
      if(!comps.length){
        list.innerHTML = '<div class="card">æš‚æ— å¯å¯¹æ¯”äº‹ä»¶ï¼Œç¨åè‡ªåŠ¨æ›´æ–°ã€‚ / No comparable events yet, please check back later.</div>';
        return;
      }

      comps.forEach((c, idx) => {
        const card = document.createElement('div');
        card.className = 'card';
        const zh = c.event_hint_zh || c.event_hint || '';
        const en = c.event_hint_en || c.event_hint || '';
        card.innerHTML = `<div class="event">äº‹ä»¶ / Event ${idx+1}ï¼š${zh}<span class="en">${en}</span></div>`;

        const toolbar = document.createElement('div');
        toolbar.className = 'toolbar';
        const readBtn = document.createElement('button');
        readBtn.className = 'btn';
        readBtn.textContent = 'ğŸ”Š æœ—è¯» / Read';
        readBtn.onclick = async () => {
          const speechText = `äº‹ä»¶ï¼š${zh}ã€‚ä¸­å›½è§†è§’ï¼š${(c['ä¸­å›½è§†è§’']&&c['ä¸­å›½è§†è§’'].title_zh)||''}ã€‚ç¾å›½è§†è§’ï¼š${(c['ç¾å›½è§†è§’']&&c['ç¾å›½è§†è§’'].title_zh)||''}ã€‚åŠå²›è§†è§’ï¼š${(c['åŠå²›è§†è§’']&&c['åŠå²›è§†è§’'].title_zh)||''}`;
          try { await speakWithAzure(speechText); }
          catch(e){ speakFallback(speechText); }
        };
        toolbar.appendChild(readBtn);
        card.appendChild(toolbar);

        const grid = document.createElement('div');
        grid.className = 'grid';
        renderItem(grid, 'ä¸­å›½è§†è§’ / China', c['ä¸­å›½è§†è§’']);
        renderItem(grid, 'ç¾å›½è§†è§’ / US', c['ç¾å›½è§†è§’']);
        renderItem(grid, 'ä¼Šæ–¯å…°è§†è§’ / Islamic (Al Jazeera)', c['åŠå²›è§†è§’']);

        card.appendChild(grid);
        list.appendChild(card);
      });
    }

    document.getElementById('readAllBtn').onclick = async () => {
      const comps = (__hotnewsData && __hotnewsData.comparisons) ? __hotnewsData.comparisons : [];
      if (!comps.length) return;
      const lines = comps.map((c, i) => {
        const zh = c.event_hint_zh || c.event_hint || '';
        const cn = (c['ä¸­å›½è§†è§’'] && c['ä¸­å›½è§†è§’'].title_zh) || '';
        const us = (c['ç¾å›½è§†è§’'] && c['ç¾å›½è§†è§’'].title_zh) || '';
        const aj = (c['åŠå²›è§†è§’'] && c['åŠå²›è§†è§’'].title_zh) || '';
        return `ç¬¬${i+1}æ¡ã€‚äº‹ä»¶ï¼š${zh}ã€‚ä¸­å›½è§†è§’ï¼š${cn}ã€‚ç¾å›½è§†è§’ï¼š${us}ã€‚åŠå²›è§†è§’ï¼š${aj}ã€‚`;
      });
      const speechText = lines.join(' ');
      try { await speakWithAzure(speechText); }
      catch(e){ speakFallback(speechText); }
    };

    load().catch(e=>{
      document.getElementById('meta').textContent = 'åŠ è½½å¤±è´¥ / Load failed: ' + e.message;
    });
  </script>
</body>
</html>
