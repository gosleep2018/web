<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CNN/BBC æ¯æ—¥10è¯ - æµè§ˆå™¨TTS + è¯æ ¹è¯ç¼€</title>
  <style>
    *{box-sizing:border-box}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;background:#0f172a;color:#e2e8f0}
    .wrap{max-width:960px;margin:0 auto;padding:20px}
    h1{font-size:28px;margin:0 0 10px;color:#60a5fa}
    .sub{color:#94a3b8;margin-bottom:16px}
    .bar{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0 20px}
    button{border:0;border-radius:10px;padding:10px 14px;cursor:pointer;color:#fff;background:#2563eb;transition:all .2s}
    button:hover{background:#1d4ed8;transform:translateY(-1px)}
    button.warn{background:#ef4444}button.alt{background:#475569}
    button:disabled{opacity:.5;cursor:not-allowed}
    .card{background:#1e293b;border:1px solid #334155;border-radius:12px;padding:20px;margin:16px 0}
    .word{font-size:24px;font-weight:700}.ph{color:#94a3b8;font-style:italic}
    .row{margin-top:8px;line-height:1.6}.zh{color:#fbbf24}
    .etymology{background:rgba(37,99,235,0.1);border-left:3px solid #2563eb;padding:12px;margin:10px 0;border-radius:0 8px 8px 0}
    .etymology-title{color:#60a5fa;font-weight:600;margin-bottom:6px}
    .example{padding:12px;border-left:3px solid #10b981;background:rgba(16,185,129,0.1);border-radius:0 8px 8px 0;margin-top:10px}
    .tag{display:inline-block;background:#334155;color:#e2e8f0;border-radius:999px;padding:4px 10px;margin:4px 6px 4px 0;font-size:12px}
    .tag.prefix{background:#3b82f6}.tag.root{background:#10b981}.tag.suffix{background:#8b5cf6}.tag.related{background:#f59e0b}
    .muted{color:#94a3b8;font-size:13px}
    .tts-badge{background:#10b981;color:white;padding:2px 8px;border-radius:4px;font-size:12px;margin-left:8px}
    .voice-select{margin-left:10px;padding:5px;border-radius:5px;background:#1e293b;color:#e2e8f0;border:1px solid #334155}
    .tts-status{background:rgba(245,158,11,0.1);border-left:3px solid #f59e0b;padding:12px;margin:15px 0;border-radius:0 8px 8px 0}
  </style>
</head>
<body>
<div class="wrap">
  <h1>ğŸ¯ CNN/BBC æ¯æ—¥10è¯ <span class="tts-badge">æµè§ˆå™¨TTS</span></h1>
  <div class="sub">ğŸ¤– è¯æ ¹è¯ç¼€è®°å¿†æ³• â€¢ ğŸ§ æµè§ˆå™¨å†…ç½®è¯­éŸ³åˆæˆ â€¢ ğŸ“– æ·±åº¦å­¦ä¹ </div>
  
  <div class="tts-status">
    <div class="etymology-title">ğŸ§ å‘éŸ³ç³»ç»ŸçŠ¶æ€</div>
    <div id="ttsStatus">æ­£åœ¨æ£€æŸ¥æµè§ˆå™¨TTSæ”¯æŒ...</div>
    <div class="muted">ä½¿ç”¨Chrome/Edge/Safariå¯è·å¾—æœ€ä½³å‘éŸ³æ•ˆæœ</div>
  </div>
  
  <div class="bar">
    <button onclick="playAllWords()">ğŸ”Š æ’­æ”¾ä»Šæ—¥10è¯</button>
    <button onclick="playAllExamples()">ğŸ§ æ’­æ”¾ä»Šæ—¥ä¾‹å¥</button>
    <button class="warn" onclick="stopAllAudio()">â¹ åœæ­¢æ‰€æœ‰å‘éŸ³</button>
    <button class="alt" onclick="refreshToday(true)">ğŸ”„ é‡æ–°æŠ½å–</button>
    <select id="voiceSelect" class="voice-select" onchange="updateVoice()">
      <option value="en-US">ç¾å¼è‹±è¯­</option>
      <option value="en-GB">è‹±å¼è‹±è¯­</option>
    </select>
  </div>
  
  <div id="today"></div>

  <div class="history">
    <h2>ğŸ“š å†å²è®°å½•ï¼ˆå¤ä¹ ï¼‰</h2>
    <div class="muted">è‡ªåŠ¨è®°å½•æ¯å¤©çš„10ä¸ªå•è¯ã€‚å¯ç‚¹å¼€æŒ‰æ—¥æœŸå¤ä¹ ã€‚</div>
    <div id="history"></div>
  </div>
</div>

<script>
// ==================== é…ç½® ====================
let currentVoice = 'en-US';
let currentUtterance = null;
let isPlaying = false;

// ==================== è¯æ±‡åº“ ====================
const VOCAB_WITH_ETYMOLOGY = [
  {
    word: "sanction",
    phonetic: "/ËˆsÃ¦Å‹kÊƒn/",
    chinese: "åˆ¶è£",
    englishDef: "A penalty imposed by one country on another.",
    example: "New sanctions were announced on Friday.",
    exampleTrans: "å‘¨äº”å®£å¸ƒäº†æ–°åˆ¶è£ã€‚",
    source: "BBC",
    etymology: {
      prefix: "",
      root: "-sanct- (ç¥åœ£çš„ï¼Œæ¥è‡ªæ‹‰ä¸è¯­ sanctus)",
      suffix: "-tion (åè¯åç¼€ï¼Œè¡¨ç¤ºè¡Œä¸ºæˆ–çŠ¶æ€)",
      memoryTip: "sanction åŸæŒ‡'ç¥åœ£åŒ–' â†’ å¼•ç”³ä¸º'å®˜æ–¹æ‰¹å‡†' â†’ ç°ä»£ä¹‰'åˆ¶è£'ï¼ˆå®˜æ–¹æ–½åŠ çš„æƒ©ç½šï¼‰",
      relatedWords: ["sanctuary (é¿éš¾æ‰€)", "sanctify (ä½¿ç¥åœ£åŒ–)", "sanctimonious (å‡è£…ç¥åœ£çš„)"]
    }
  },
  {
    word: "benchmark",
    phonetic: "/ËˆbentÊƒmÉ‘Ëk/",
    chinese: "åŸºå‡†",
    englishDef: "A standard for comparison.",
    example: "Oil prices hit a new benchmark.",
    exampleTrans: "æ²¹ä»·è§¦åŠæ–°åŸºå‡†ã€‚",
    source: "BBC",
    etymology: {
      prefix: "",
      root: "å¤åˆè¯ï¼šbench (é•¿å‡³) + mark (æ ‡è®°)",
      suffix: "",
      memoryTip: "å†å²ï¼šæµ‹é‡å‘˜åœ¨é•¿å‡³ä¸Šåšæ ‡è®°ä½œä¸ºå‚è€ƒç‚¹ â†’ å¼•ç”³ä¸º'åŸºå‡†'",
      relatedWords: ["landmark (åœ°æ ‡)", "hallmark (æ ‡å¿—)", "watermark (æ°´å°)"]
    }
  },
  {
    word: "innovation",
    phonetic: "/ËŒÉªnÉ™ËˆveÉªÊƒn/",
    chinese: "åˆ›æ–°",
    englishDef: "A new method, idea, or product.",
    example: "Technological innovation is driving growth.",
    exampleTrans: "æŠ€æœ¯åˆ›æ–°æ­£åœ¨æ¨åŠ¨å¢é•¿ã€‚",
    source: "BBC",
    etymology: {
      prefix: "in- (è¿›å…¥ï¼Œä½¿...)",
      root: "-nov- (æ–°çš„ï¼Œæ‹‰ä¸è¯­ novus)",
      suffix: "-ation (åè¯åç¼€ï¼Œè¡¨ç¤ºè¡Œä¸ºæˆ–ç»“æœ)",
      memoryTip: "å­—é¢ï¼šä½¿è¿›å…¥æ–°çŠ¶æ€ â†’ åˆ›æ–°",
      relatedWords: ["novel (æ–°é¢–çš„)", "renovate (ç¿»æ–°)", "nova (æ–°æ˜Ÿ)", "novice (æ–°æ‰‹)"]
    }
  },
  {
    word: "sovereignty",
    phonetic: "/ËˆsÉ’vrÉ™nti/",
    chinese: "ä¸»æƒ",
    englishDef: "A state's authority to govern itself.",
    example: "The debate focused on national sovereignty.",
    exampleTrans: "è®¨è®ºèšç„¦å›½å®¶ä¸»æƒã€‚",
    source: "CNN",
    etymology: {
      prefix: "",
      root: "-sovereign- (æœ€é«˜çš„ï¼Œç»Ÿæ²»çš„ï¼Œæ¥è‡ªå¤æ³•è¯­ soverain)",
      suffix: "-ty (åè¯åç¼€ï¼Œè¡¨ç¤ºçŠ¶æ€æˆ–æ€§è´¨)",
      memoryTip: "sovereign (å›ä¸») + -ty â†’ å›ä¸»çš„çŠ¶æ€ â†’ ä¸»æƒ",
      relatedWords: ["sovereign (å›ä¸»)", "reign (ç»Ÿæ²»)", "sovereignty dispute (ä¸»æƒäº‰ç«¯)"]
    }
  },
  {
    word: "compliance",
    phonetic: "/kÉ™mËˆplaÉªÉ™ns/",
    chinese: "åˆè§„",
    englishDef: "Conforming to rules or standards.",
    example: "The company improved its compliance procedures.",
    exampleTrans: "å…¬å¸æ”¹è¿›äº†åˆè§„ç¨‹åºã€‚",
    source: "CNN",
    etymology: {
      prefix: "com- (å…±åŒï¼Œå®Œå…¨)",
      root: "-pli- (æŠ˜å ï¼Œå¼¯æ›²ï¼Œæ‹‰ä¸è¯­ plicare)",
      suffix: "-ance (åè¯åç¼€ï¼Œè¡¨ç¤ºçŠ¶æ€)",
      memoryTip: "å­—é¢ï¼šå®Œå…¨æŠ˜å ï¼ˆå±ˆæœï¼‰â†’ éµå®ˆï¼Œé¡ºä»",
      relatedWords: ["comply (éµå®ˆ)", "compliant (é¡ºä»çš„)", "complex (å¤æ‚çš„)", "duplicate (å¤åˆ¶)"]
    }
  },
  {
    word: "inequality",
    phonetic: "/ËŒÉªnÉªËˆkwÉ’lÉ™ti/",
    chinese: "ä¸å¹³ç­‰",
    englishDef: "Lack of equality in society.",
    example: "The report highlights income inequality.",
    exampleTrans: "æŠ¥å‘Šå¼ºè°ƒäº†æ”¶å…¥ä¸å¹³ç­‰ã€‚",
    source: "BBC",
    etymology: {
      prefix: "in- (ä¸ï¼Œå¦å®š)",
      root: "-equ- (ç›¸ç­‰ï¼Œæ‹‰ä¸è¯­ aequus)",
      suffix: "-ity (åè¯åç¼€ï¼Œè¡¨ç¤ºçŠ¶æ€)",
      memoryTip: "ç»“æ„ï¼šin- (ä¸) + equal (å¹³ç­‰) + -ity (çŠ¶æ€) â†’ ä¸å¹³ç­‰çŠ¶æ€",
      relatedWords: ["equality (å¹³ç­‰)", "equitable (å…¬å¹³çš„)", "equator (èµ¤é“)", "equation (æ–¹ç¨‹å¼)"]
    }
  },
  {
    word: "enforcement",
    phonetic: "/ÉªnËˆfÉ”ËsmÉ™nt/",
    chinese: "æ‰§è¡Œ",
    englishDef: "Ensuring compliance with laws.",
    example: "Law enforcement agencies are investigating.",
    exampleTrans: "æ‰§æ³•æœºæ„æ­£åœ¨è°ƒæŸ¥ã€‚",
    source: "BBC",
    etymology: {
      prefix: "en- (ä½¿æˆä¸ºï¼Œæ”¾å…¥)",
      root: "-force- (åŠ›é‡ï¼Œæ‹‰ä¸è¯­ fortis)",
      suffix: "-ment (åè¯åç¼€ï¼Œè¡¨ç¤ºè¡Œä¸ºæˆ–ç»“æœ)",
      memoryTip: "å­—é¢ï¼šä½¿å…·æœ‰åŠ›é‡ â†’ å¼ºåˆ¶æ‰§è¡Œ",
      relatedWords: ["enforce (æ‰§è¡Œ)", "force (åŠ›é‡)", "reinforce (åŠ å¼º)", "fortify (åŠ å¼º)"]
    }
  },
  {
    word: "sustainability",
    phonetic: "/sÉ™ËŒsteÉªnÉ™ËˆbÉªlÉ™ti/",
    chinese: "å¯æŒç»­æ€§",
    englishDef: "Ability to maintain at a certain level.",
    example: "Sustainability is key for future growth.",
    exampleTrans: "å¯æŒç»­æ€§æ˜¯æœªæ¥å¢é•¿çš„å…³é”®ã€‚",
    source: "CNN",
    etymology: {
      prefix: "sus- (åœ¨ä¸‹é¢ï¼Œsub- å˜ä½“)",
      root: "-tain- (æŒæœ‰ï¼Œä¿æŒï¼Œæ‹‰ä¸è¯­ tenere)",
      suffix: "-able (èƒ½å¤Ÿ...çš„) + -ity (åè¯åç¼€ï¼Œè¡¨ç¤ºæ€§è´¨)",
      memoryTip: "ç»“æ„ï¼šsus- (åœ¨ä¸‹é¢) + tain (æŒæœ‰) + -able (èƒ½å¤Ÿ) + -ity (æ€§è´¨) â†’ èƒ½å¤ŸæŒç»­æ”¯æ’‘çš„æ€§è´¨",
      relatedWords: ["sustain (ç»´æŒ)", "maintain (ç»´æŒ)", "retain (ä¿ç•™)", "contain (åŒ…å«)"]
    }
  },
  {
    word: "diplomacy",
    phonetic: "/dÉªËˆplÉ™ÊŠmÉ™si/",
    chinese: "å¤–äº¤",
    englishDef: "Managing international relations.",
    example: "Diplomacy reduced tensions in the region.",
    exampleTrans: "å¤–äº¤ç¼“å’Œäº†åœ°åŒºç´§å¼ å±€åŠ¿ã€‚",
    source: "BBC",
    etymology: {
      prefix: "",
      root: "-diplo- (åŒé‡çš„ï¼ŒæŠ˜å çš„ï¼Œå¸Œè…Šè¯­ diploos)",
      suffix: "-macy (åè¯åç¼€ï¼Œæ¥è‡ªå¸Œè…Šè¯­ -mateia)",
      memoryTip: "å†å²ï¼šdiploma (æ–‡å‡­) åŸæŒ‡æŠ˜å çš„å®˜æ–¹æ–‡ä»¶ â†’ å¤–äº¤å®˜æºå¸¦çš„å‡­è¯ â†’ å¤–äº¤è‰ºæœ¯",
      relatedWords: ["diplomat (å¤–äº¤å®˜)", "diplomatic (å¤–äº¤çš„)", "diploma (æ–‡å‡­)", "duplicate (å¤åˆ¶)"]
    }
  },
  {
    word: "tariff",
    phonetic: "/ËˆtÃ¦rÉªf/",
    chinese: "å…³ç¨",
    englishDef: "A tax on imported goods.",
    example: "The new tariff affects steel imports.",
    exampleTrans: "æ–°å…³ç¨å½±å“é’¢é“è¿›å£ã€‚",
    source: "CNN",
    etymology: {
      prefix: "",
      root: "æ¥è‡ªé˜¿æ‹‰ä¼¯è¯­ ta'rif (é€šçŸ¥ï¼Œå…¬å‘Š)",
      suffix: "",
      memoryTip: "å†å²ï¼šåŸæŒ‡æ¸¯å£å…¬å¸ƒçš„å…³ç¨è¡¨ â†’ æ³›æŒ‡å…³ç¨",
      relatedWords: ["customs duty (å…³ç¨)", "import tax (è¿›å£ç¨)", "trade barrier (è´¸æ˜“å£å’)"]
    }
  }
];

// ==================== TTS æ ¸å¿ƒå‡½æ•° ====================
function checkTTSsupport() {
  const statusEl = document.getElementById('ttsStatus');
  
  if (!('speechSynthesis' in window)) {
    statusEl.innerHTML = 'âŒ æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½ã€‚<br>å»ºè®®ä½¿ç”¨ï¼šChromeã€Edgeã€Safari';
    statusEl.style.color = '#ef4444';
    return false;
  }
  
  // å°è¯•è·å–å¯ç”¨è¯­éŸ³
  const voices = speechSynthesis.getVoices();
  if (voices.length === 0) {
    statusEl.innerHTML = 'âš ï¸ æ­£åœ¨åŠ è½½è¯­éŸ³å¼•æ“...ï¼ˆå¯èƒ½éœ€è¦å‡ ç§’é’Ÿï¼‰';
    statusEl.style.color = '#f59e0b';
    
    // è¯­éŸ³åŠ è½½åæ›´æ–°çŠ¶æ€
    speechSynthesis.onvoiceschanged = () => {
      const loadedVoices = speechSynthesis.getVoices();
      if (loadedVoices.length > 0) {
        statusEl.innerHTML = `âœ… TTSå·²å°±ç»ªï¼Œ${loadedVoices.length}ä¸ªè¯­éŸ³å¯ç”¨`;
        statusEl.style.color = '#10b981';
      }
    };
    
    // è®¾ç½®è¶…æ—¶æ£€æŸ¥
    setTimeout(() => {
      const finalVoices = speechSynthesis.getVoices();
      if (finalVoices.length === 0) {
        statusEl.innerHTML = 'âš ï¸ è¯­éŸ³å¼•æ“åŠ è½½è¾ƒæ…¢ï¼Œç‚¹å‡»å‘éŸ³æŒ‰é’®å¯èƒ½ä¼šå»¶è¿Ÿå“åº”';
        statusEl.style.color = '#f59e0b';
      }
    }, 3000);
    
    return true;
  }
  
  statusEl.innerHTML = `âœ… TTSå·²å°±ç»ªï¼Œ${voices.length}ä¸ªè¯­éŸ³å¯ç”¨`;
  statusEl.style.color = '#10b981';
  return true;
}

function speakText(text, rate = 0.8) {
  stopAllAudio();
  
  if (!('speechSynthesis' in window)) {
    alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½ã€‚è¯·ä½¿ç”¨Chromeã€Edgeæˆ–Safariæµè§ˆå™¨ã€‚');
    return;
  }
  
  currentUtterance = new SpeechSynthesisUtterance(text);
  currentUtterance.lang = currentVoice;
  currentUtterance.rate = rate;
  currentUtterance.volume = 1;
  
  currentUtterance.onstart = () => {
    isPlaying = true;
    updateAudioStatus();
  };
  
  currentUtterance.onend = () => {
    isPlaying = false;
    updateAudioStatus();
  };
  
  currentUtterance.onerror = (err) => {
    console.error('è¯­éŸ³åˆæˆé”™è¯¯:', err);
    isPlaying = false;
    updateAudioStatus();
    alert('å‘éŸ³å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®æˆ–å°è¯•å…¶ä»–æµè§ˆå™¨ã€‚');
  };
  
  speechSynthesis.speak(currentUtterance);
}

function stopAllAudio() {
  if (speechSynthesis.speaking) {
    speechSynthesis.cancel();
  }
  isPlaying = false;
  updateAudioStatus();
}

function updateAudioStatus() {
  const buttons = document.querySelectorAll('button');
  buttons.forEach(btn => {
    if (btn.textContent.includes('åœæ­¢')) {
      btn.style.display = isPlaying ? 'inline-block' : 'none';
    }
  });
}

function updateVoice() {
  currentVoice = document.getElementById('voiceSelect').value;
}

// ==================== æ’­æ”¾å‡½æ•° ====================
function playWord(word) { 
  speakText(word, 0.7); 
}

function playExample(sentence) { 
  speakText(sentence, 0.8); 
}

function playDef(definition) { 
  speakText(definition, 0.75); 
}

async function playAllWords() {
  const words = getTodayWords();
  stopAllAudio();
  
  for (const w of words) {
    if (!isPlaying) break;
    speakText(w.word, 0.7);
    await waitForSpeechEnd();
    await new Promise(r => setTimeout(r, 500));
  }
}

async function playAllExamples() {
  const words = getTodayWords();
  stopAllAudio();
  
  for (const w of words) {
    if (!isPlaying) break;
    speakText(w.example, 0.8);
    await waitForSpeechEnd();
    await new Promise(r => setTimeout(r, 500));
  }
}

function waitForSpeechEnd() {
  return new Promise(resolve => {
    const check = setInterval(() => {
      if (!isPlaying) {
        clearInterval(check);
        resolve();
      }
    }, 100);
  });
}

// ==================== æ—¥æœŸå’Œå­˜å‚¨å‡½æ•° ====================
function dateKey(){
  const d = new Date();
  const y=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,'0'),day=String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}

function seededShuffle(arr, seedStr){
  let seed = [...seedStr].reduce((a,c)=>a+c.charCodeAt(0),