<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CNN/BBC æ¯æ—¥10è¯ - å¾®è½¯Azure TTSä¸“ä¸šå‘éŸ³</title>
  <style>
    *{box-sizing:border-box}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;background:#0f172a;color:#e2e8f0}
    .wrap{max-width:960px;margin:0 auto;padding:20px}
    h1{font-size:28px;margin:0 0 10px;color:#60a5fa}
    .sub{color:#94a3b8;margin-bottom:16px}
    .bar{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0 20px}
    button{border:0;border-radius:10px;padding:10px 14px;cursor:pointer;color:#fff;background:#2563eb;transition:all .2s}
    button:hover{background:#1d4ed8;transform:translateY(-1px)}
    button.warn{background:#ef4444}button.alt{background:#475569}
    button:disabled{opacity:.5;cursor:not-allowed}
    .card{background:#1e293b;border:1px solid #334155;border-radius:12px;padding:16px;margin:12px 0}
    .word{font-size:24px;font-weight:700}.ph{color:#94a3b8;font-style:italic}
    .row{margin-top:8px;line-height:1.6}.zh{color:#fbbf24}
    .example{padding:10px;border-left:3px solid #60a5fa;background:#0f172a;border-radius:8px;margin-top:8px}
    .history{margin-top:28px}.history h2{font-size:20px;color:#93c5fd}
    details{background:#111827;border:1px solid #334155;border-radius:10px;padding:8px 12px;margin:8px 0}
    summary{cursor:pointer;color:#cbd5e1}
    .tag{display:inline-block;background:#334155;color:#e2e8f0;border-radius:999px;padding:2px 8px;margin:4px 6px 0 0;font-size:12px}
    .muted{color:#94a3b8;font-size:13px}
    .audio-status{display:inline-block;margin-left:8px;font-size:12px}
    .audio-status.playing{color:#10b981}
    .audio-status.error{color:#ef4444}
  </style>
</head>
<body>
<div class="wrap">
  <h1>ğŸ§ CNN/BBC æ¯æ—¥10è¯</h1>
  <div class="sub">ğŸ¤– å¾®è½¯Azureç¥ç»ç½‘ç»œTTSä¸“ä¸šå‘éŸ³ â€¢ ğŸ“– ä¸­æ–‡è§£é‡Š+è‹±æ–‡é‡Šä¹‰ â€¢ ğŸ“š å†å²å¤ä¹ </div>
  <div class="bar">
    <button onclick="playAllWords()">ğŸ”Š æ’­æ”¾ä»Šæ—¥10è¯ (Azure TTS)</button>
    <button onclick="playAllExamples()">ğŸ§ æ’­æ”¾ä»Šæ—¥ä¾‹å¥ (Azure TTS)</button>
    <button class="warn" onclick="stopAllAudio()">â¹ åœæ­¢æ‰€æœ‰å‘éŸ³</button>
    <button class="alt" onclick="refreshToday(true)">ğŸ”„ é‡æ–°æŠ½å–ä»Šæ—¥10è¯</button>
  </div>
  <div id="today"></div>

  <div class="history">
    <h2>ğŸ“š å†å²è®°å½•ï¼ˆå¤ä¹ ï¼‰</h2>
    <div class="muted">è‡ªåŠ¨è®°å½•æ¯å¤©çš„10ä¸ªå•è¯ã€‚å¯ç‚¹å¼€æŒ‰æ—¥æœŸå¤ä¹ ã€‚</div>
    <div id="history"></div>
  </div>
</div>

<script>
// é…ç½®
const TTS_PROXY_URL = 'http://localhost:3000/tts'; // Azure TTSä»£ç†æœåŠ¡
const TODAY_VOICE = 'en-US-JennyNeural'; // ä»Šæ—¥å•è¯è¯­éŸ³
const EXAMPLE_VOICE = 'en-US-JennyNeural'; // ä¾‹å¥è¯­éŸ³
const DEF_VOICE = 'en-US-GuyNeural'; // é‡Šä¹‰è¯­éŸ³

// è¯æ±‡åº“ï¼ˆ35ä¸ªæ–°é—»è¯æ±‡ï¼‰
const VOCAB = [
  ["election","/ÉªËˆlekÊƒn/","é€‰ä¸¾","A formal voting process to choose leaders.","The presidential election will be held next month.","æ€»ç»Ÿé€‰ä¸¾å°†äºä¸‹ä¸ªæœˆä¸¾è¡Œã€‚","CNN"],
  ["summit","/ËˆsÊŒmÉªt/","å³°ä¼š","A high-level meeting between leaders.","World leaders will attend the climate summit.","ä¸–ç•Œé¢†å¯¼äººå°†å‡ºå¸­æ°”å€™å³°ä¼šã€‚","CNN"],
  ["parliament","/ËˆpÉ‘ËrlÉ™mÉ™nt/","è®®ä¼š","A country's main law-making body.","The bill was passed by parliament yesterday.","è¯¥æ³•æ¡ˆæ˜¨å¤©åœ¨è®®ä¼šé€šè¿‡ã€‚","BBC"],
  ["innovation","/ËŒÉªnÉ™ËˆveÉªÊƒn/","åˆ›æ–°","A new method, idea, or product.","Technological innovation is driving growth.","æŠ€æœ¯åˆ›æ–°æ­£åœ¨æ¨åŠ¨å¢é•¿ã€‚","BBC"],
  ["inequality","/ËŒÉªnÉªËˆkwÉ’lÉ™ti/","ä¸å¹³ç­‰","Lack of equality in society.","The report highlights income inequality.","æŠ¥å‘Šå¼ºè°ƒäº†æ”¶å…¥ä¸å¹³ç­‰ã€‚","BBC"],
  ["inflation","/ÉªnËˆfleÉªÊƒn/","é€šè´§è†¨èƒ€","A general rise in prices.","Inflation has reached a 10-year high.","é€šèƒ€è¾¾åˆ°åå¹´é«˜ä½ã€‚","BBC"],
  ["climate","/ËˆklaÉªmÉ™t/","æ°”å€™","Long-term weather patterns.","Climate change is affecting weather patterns.","æ°”å€™å˜åŒ–æ­£åœ¨å½±å“å¤©æ°”æ¨¡å¼ã€‚","CNN"],
  ["reform","/rÉªËˆfÉ”Ërm/","æ”¹é©","A change made to improve a system.","Education reform is a key priority.","æ•™è‚²æ”¹é©æ˜¯é‡ç‚¹ã€‚","CNN"],
  ["diplomacy","/dÉªËˆplÉ™ÊŠmÉ™si/","å¤–äº¤","Managing international relations.","Diplomacy reduced tensions in the region.","å¤–äº¤ç¼“å’Œäº†åœ°åŒºç´§å¼ å±€åŠ¿ã€‚","BBC"],
  ["GDP","/ËŒdÊ’iË diË ËˆpiË/","å›½å†…ç”Ÿäº§æ€»å€¼","Total value of goods/services produced.","GDP grew by 3% this quarter.","æœ¬å­£åº¦GDPå¢é•¿3%ã€‚","CNN"],
  ["sanction","/ËˆsÃ¦Å‹kÊƒn/","åˆ¶è£","A penalty imposed by one country on another.","New sanctions were announced on Friday.","å‘¨äº”å®£å¸ƒäº†æ–°åˆ¶è£ã€‚","BBC"],
  ["ceasefire","/ËˆsiËsfaÉªÉ™(r)/","åœç«","An agreement to stop fighting.","Both sides agreed to a temporary ceasefire.","åŒæ–¹åŒæ„ä¸´æ—¶åœç«ã€‚","CNN"],
  ["coalition","/ËŒkÉ™ÊŠÉ™ËˆlÉªÊƒn/","è”ç›Ÿ","A temporary alliance for combined action.","A coalition government was formed.","è”åˆæ”¿åºœæˆç«‹äº†ã€‚","BBC"],
  ["tariff","/ËˆtÃ¦rÉªf/","å…³ç¨","A tax on imported goods.","The new tariff affects steel imports.","æ–°å…³ç¨å½±å“é’¢é“è¿›å£ã€‚","CNN"],
  ["benchmark","/ËˆbentÊƒmÉ‘Ëk/","åŸºå‡†","A standard for comparison.","Oil prices hit a new benchmark.","æ²¹ä»·è§¦åŠæ–°åŸºå‡†ã€‚","BBC"],
  ["volatility","/ËŒvÉ’lÉ™ËˆtÉªlÉ™ti/","æ³¢åŠ¨æ€§","Frequent and large changes.","Markets showed high volatility today.","ä»Šå¤©å¸‚åœºæ³¢åŠ¨è¾ƒå¤§ã€‚","CNN"],
  ["consensus","/kÉ™nËˆsensÉ™s/","å…±è¯†","General agreement among a group.","Economists reached a consensus on rates.","ç»æµå­¦å®¶å¯¹åˆ©ç‡å½¢æˆå…±è¯†ã€‚","BBC"],
  ["fiscal","/ËˆfÉªskl/","è´¢æ”¿çš„","Related to government revenue and spending.","Fiscal policy will be tightened.","è´¢æ”¿æ”¿ç­–å°†æ”¶ç´§ã€‚","CNN"],
  ["stimulus","/ËˆstÉªmjÉ™lÉ™s/","åˆºæ¿€æªæ–½","Action to encourage economic activity.","The government announced a stimulus package.","æ”¿åºœå®£å¸ƒåˆºæ¿€æ–¹æ¡ˆã€‚","BBC"],
  ["sovereignty","/ËˆsÉ’vrÉ™nti/","ä¸»æƒ","A state's authority to govern itself.","The debate focused on national sovereignty.","è®¨è®ºèšç„¦å›½å®¶ä¸»æƒã€‚","CNN"],
  ["deficit","/ËˆdefÉªsÉªt/","èµ¤å­—","The amount by which spending exceeds income.","The budget deficit widened this year.","ä»Šå¹´é¢„ç®—èµ¤å­—æ‰©å¤§ã€‚","BBC"],
  ["recession","/rÉªËˆseÊƒn/","è¡°é€€","A period of economic decline.","The country entered a mild recession.","è¯¥å›½è¿›å…¥è½»åº¦è¡°é€€ã€‚","CNN"],
  ["infrastructure","/ËˆÉªnfrÉ™strÊŒktÊƒÉ™(r)/","åŸºç¡€è®¾æ–½","Basic physical systems of a country.","Infrastructure investment is crucial.","åŸºç¡€è®¾æ–½æŠ•èµ„è‡³å…³é‡è¦ã€‚","BBC"],
  ["sustainability","/sÉ™ËŒsteÉªnÉ™ËˆbÉªlÉ™ti/","å¯æŒç»­æ€§","Ability to maintain at a certain level.","Sustainability is key for future growth.","å¯æŒç»­æ€§æ˜¯æœªæ¥å¢é•¿çš„å…³é”®ã€‚","CNN"],
  ["transparency","/trÃ¦nsËˆpÃ¦rÉ™nsi/","é€æ˜åº¦","Openness and accountability.","The company promised greater transparency.","å…¬å¸æ‰¿è¯ºæé«˜é€æ˜åº¦ã€‚","BBC"],
  ["bureaucracy","/bjÊŠÉ™ËˆrÉ’krÉ™si/","å®˜åƒšä¸»ä¹‰","Complex administrative procedures.","Bureaucracy slows down decision-making.","å®˜åƒšä¸»ä¹‰æ‹–æ…¢å†³ç­–ã€‚","CNN"],
  ["accountability","/É™ËŒkaÊŠntÉ™ËˆbÉªlÉ™ti/","é—®è´£åˆ¶","Responsibility for one's actions.","There must be accountability for mistakes.","é”™è¯¯å¿…é¡»æœ‰é—®è´£ã€‚","BBC"],
  ["legislation","/ËŒledÊ’ÉªsËˆleÉªÊƒn/","ç«‹æ³•","Laws considered collectively.","New legislation will be introduced next month.","æ–°ç«‹æ³•å°†äºä¸‹æœˆæ¨å‡ºã€‚","CNN"],
  ["ratification","/ËŒrÃ¦tÉªfÉªËˆkeÉªÊƒn/","æ‰¹å‡†","Formal approval of an agreement.","The treaty needs ratification by parliament.","æ¡çº¦éœ€è¦è®®ä¼šæ‰¹å‡†ã€‚","BBC"],
  ["implementation","/ËŒÉªmplÉªmenËˆteÉªÊƒn/","å®æ–½","The process of putting a plan into effect.","Implementation of the policy begins next week.","æ”¿ç­–å®æ–½ä¸‹å‘¨å¼€å§‹ã€‚","CNN"],
  ["enforcement","/ÉªnËˆfÉ”ËsmÉ™nt/","æ‰§è¡Œ","Ensuring compliance with laws.","Law enforcement agencies are investigating.","æ‰§æ³•æœºæ„æ­£åœ¨è°ƒæŸ¥ã€‚","BBC"],
  ["compliance","/kÉ™mËˆplaÉªÉ™ns/","åˆè§„","Conforming to rules or standards.","The company improved its compliance procedures.","å…¬å¸æ”¹è¿›äº†åˆè§„ç¨‹åºã€‚","CNN"],
  ["oversight","/ËˆÉ™ÊŠvÉ™saÉªt/","ç›‘ç£","Supervision or watchful care.","Congress has oversight of the program.","å›½ä¼šå¯¹è¯¥è®¡åˆ’æœ‰ç›‘ç£æƒã€‚","BBC"],
  ["advocacy","/ËˆÃ¦dvÉ™kÉ™si/","å€¡å¯¼","Public support for a cause.","Environmental advocacy groups are growing.","ç¯ä¿å€¡å¯¼å›¢ä½“æ­£åœ¨å£®å¤§ã€‚","CNN"],
  ["mediation","/ËŒmiËdiËˆeÉªÊƒn/","è°ƒè§£","Intervention to resolve a dispute.","Mediation helped settle the conflict.","è°ƒè§£å¸®åŠ©è§£å†³äº†å†²çªã€‚","BBC"]
];

// çŠ¶æ€ç®¡ç†
let currentAudio = null;
let isPlaying = false;

// æ—¥æœŸç›¸å…³å‡½æ•°
function dateKey(){
  const d = new Date();
  const y=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,'0'),day=String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}

function seededShuffle(arr, seedStr){
  let seed = [...seedStr].reduce((a,c)=>a+c.charCodeAt(0),0) || 1;
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    seed = (seed * 9301 + 49297) % 233280;
    const j = Math.floor((seed/233280)*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function getTodayWords(forceNew=false){
  const k = dateKey();
  const store = JSON.parse(localStorage.getItem('vocabHistory')||'{}');
  if(!forceNew && store[k] && store[k].length===10) return store[k];
  const picked = seededShuffle(VOCAB, k + (forceNew?'-force':'' )).slice(0,10);
  store[k]=picked;
  localStorage.setItem('vocabHistory', JSON.stringify(store));
  return picked;
}

// Azure TTSå‡½æ•°
async function speakWithAzureTTS(text, voice = TODAY_VOICE) {
  stopAllAudio();
  
  try {
    const url = `${TTS_PROXY_URL}?text=${encodeURIComponent(text)}&voice=${voice}`;
    const response = await fetch(url);
    
    if (!response.ok) {
      throw new Error(`TTSè¯·æ±‚å¤±è´¥: ${response.status}`);
    }
    
    const audioBlob = await response.blob();
    const audioUrl = URL.createObjectURL(audioBlob);
    
    currentAudio = new Audio(audioUrl);
    currentAudio.onended = () => {
      isPlaying = false;
      updateAudioStatus();
    };
    currentAudio.onerror = (err) => {
      console.error('éŸ³é¢‘æ’­æ”¾é”™è¯¯:', err);
      isPlaying = false;
      updateAudioStatus();
    };
    
    isPlaying = true;
    updateAudioStatus();
    await currentAudio.play();
    
  } catch (error) {
    console.error('Azure TTSå¤±è´¥:', error);
    // é™çº§åˆ°Web Speech API
    speakWithFallback(text);
  }
}

function speakWithFallback(text) {
  if ('speechSynthesis' in window) {
    stopAllAudio();
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    utterance.rate = 0.8;
    
    utterance.onend = () => {
      isPlaying = false;
      updateAudioStatus();
    };
    
    currentAudio = utterance;
    isPlaying = true;
    updateAudioStatus();
    speechSynthesis.speak(utterance);
  } else {
    alert('æŠ±æ­‰ï¼Œæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½ã€‚');
  }
}

function stopAllAudio() {
  if (currentAudio instanceof Audio) {
    currentAudio.pause();
    currentAudio.currentTime = 0;
  } else if (currentAudio instanceof SpeechSynthesisUtterance) {
    speechSynthesis.cancel();
  }
  isPlaying = false;
  updateAudioStatus();
}

function updateAudioStatus() {
  const buttons = document.querySelectorAll('button');
  buttons.forEach(btn => {
    if (btn.textContent.includes('åœæ­¢')) {
      btn.style.display = isPlaying ? 'inline-block' : 'none';
    }
  });
}

// æ’­æ”¾å‡½æ•°
function playWord(word) { speakWithAzureTTS(word, TODAY_VOICE); }
function playExample(sentence) { speakWithAzureTTS(sentence, EXAMPLE_VOICE); }
function playDef(definition) { speakWithAzureTTS(definition, DEF_VOICE); }

async function playAllWords() {
  const words = getTodayWords();
  stopAllAudio();
  
  for (const w of words) {
    if (!isPlaying) break;
    await speakWithAzureTTS(w[0], TODAY_VOICE);
    await new Promise(resolve => {
      const check = setInterval(() => {
        if (!isPlaying) {
          clearInterval(check);
          resolve();
        }
      }, 100);
      if (currentAudio instanceof Audio) {
        currentAudio.onended = () => {
          clearInterval(check);
          resolve();
        };
      }
    });
    await new Promise(r => setTimeout(r, 500));
  }
}

async function playAllExamples() {
  const words = getTodayWords();
  stopAllAudio();
  
  for (const w of words) {
    if (!isPlaying) break;
    await speakWithAzureTTS(w[4], EXAMPLE_VOICE);
    await new Promise(resolve => {
      const check = setInterval(() => {
        if (!isPlaying) {
          clearInterval(check);
          resolve();
        }
      }, 100);
      if (currentAudio instanceof Audio) {
        currentAudio.onended = () => {
          clearInterval(check);
          resolve();
        };
      }
    });
    await new Promise(r => setTimeout(r, 500));
  }
}

// æ¸²æŸ“å‡½æ•°
function renderToday(forceNew=false){
  const box=document.getElementById('today');
  const words=getTodayWords(forceNew);
  box.innerHTML = `<div class="muted">ä»Šæ—¥æ—¥æœŸï¼š2026-02-18ï¼ˆ10ä¸ªï¼‰â€¢ ğŸ¤– å¾®è½¯Azureç¥ç»ç½‘ç»œTTS â€¢ æ›´æ–°æ—¶é—´: 08:54:13</div>` + words.map((w,i)=>`
    <div class="card">
      <div class="word">${i+1}. ${w[0]}</div>
      <div class="ph">${w[1]}</div>
      <div class="row zh">ä¸­æ–‡è§£é‡Šï¼š${w[2]}</div>
      <div class="row">è‹±æ–‡é‡Šä¹‰ï¼š${w[3]}</div>
      <div class="example">
        <div>${w[4]}</div>
        <div class="muted">${w[5]} â€¢ æ¥æº: ${w[6]}</div>
      </div>
      <div class="bar">
        <button onclick="playWord('${w[0].replace(/'/g,"\\'")}')">ğŸ”Š å•è¯å‘éŸ³ (Azure)</button>
        <button onclick="playExample('${w[4].replace(/'/g,"\\'")}')">ğŸ§ ä¾‹å¥å‘éŸ³ (Azure)</button>
        <button class="alt" onclick="playDef('${w[3].replace(/'/g,"\\'")}')">ğŸ“– é‡Šä¹‰å‘éŸ³ (Azure)</button>
        <button class="warn" onclick="stopAllAudio()" style="display:none">â¹ åœæ­¢</button>
      </div>
    </div>`).join('');
}

function renderHistory(){
  const el=document.getElementById('history');
  const store=JSON.parse(localStorage.getItem('vocabHistory')||'