            
            playQueue = [...words];
            isPlayingAll = true;
            
            // é‡ç½®æ‰€æœ‰æŒ‰é’®çŠ¶æ€
            const buttons = document.querySelectorAll('.pronunciation-btn');
            buttons.forEach(btn => btn.classList.remove('playing'));
            
            playNextWord();
        }
        
        function playNextWord() {
            if (!isPlayingAll || playQueue.length === 0) {
                isPlayingAll = false;
                return;
            }
            
            const word = playQueue.shift();
            const button = document.querySelector(`.pronunciation-btn[onclick*="${word}"]`);
            
            if (button) {
                button.classList.add('playing');
                
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                utterance.pitch = 1;
                utterance.volume = 1;
                
                utterance.onend = function() {
                    button.classList.remove('playing');
                    setTimeout(playNextWord, 800); // å•è¯é—´é—´éš”
                };
                
                speechSynthesis.speak(utterance);
                currentAudio = utterance;
            } else {
                playNextWord();
            }
        }
        
        // åœæ­¢æ‰€æœ‰å‘éŸ³
        function stopAllAudio() {
            isPlayingAll = false;
            playQueue = [];
            speechSynthesis.cancel();
            
            const buttons = document.querySelectorAll('.pronunciation-btn');
            buttons.forEach(btn => btn.classList.remove('playing'));
        }
        
        // å­¦ä¹ çŠ¶æ€ç®¡ç†
        function markAsLearned(word) {
            const card = event.target.closest('.word-card');
            card.style.opacity = '0.9';
            card.style.borderColor = '#10b981';
            
            // ä¿å­˜åˆ°localStorage
            const learnedWords = JSON.parse(localStorage.getItem('learnedWords') || '[]');
            if (!learnedWords.includes(word)) {
                learnedWords.push(word);
                localStorage.setItem('learnedWords', JSON.stringify(learnedWords));
            }
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const btn = event.target;
            btn.innerHTML = 'âœ… å·²å­¦ä¹ ';
            btn.classList.remove('btn-primary');
            btn.classList.add('btn-success');
            btn.disabled = true;
            
            updateLearningStats();
        }
        
        function markAllAsLearned() {
            const words = [
                'election', 'parliament', 'inflation', 'GDP',
                'inequality', 'reform', 'diplomacy', 'summit',
                'innovation', 'climate'
            ];
            
            words.forEach(word => {
                const card = document.querySelector(`.word-card:has(.word:contains("${word}"))`);
                if (card) {
                    card.style.opacity = '0.9';
                    card.style.borderColor = '#10b981';
                }
                
                const button = card?.querySelector('.btn-primary');
                if (button) {
                    button.innerHTML = 'âœ… å·²å­¦ä¹ ';
                    button.classList.remove('btn-primary');
                    button.classList.add('btn-success');
                    button.disabled = true;
                }
            });
            
            localStorage.setItem('learnedWords', JSON.stringify(words));
            updateLearningStats();
            
            alert('ğŸ‰ å·²æ ‡è®°æ‰€æœ‰å•è¯ä¸ºå·²å­¦ä¹ ï¼');
        }
        
        function addToReview(word) {
            const reviewWords = JSON.parse(localStorage.getItem('reviewWords') || '[]');
            if (!reviewWords.includes(word)) {
                reviewWords.push(word);
                localStorage.setItem('reviewWords', JSON.stringify(reviewWords));
                alert(`âœ… "${word}" å·²åŠ å…¥å¤ä¹ åˆ—è¡¨`);
            } else {
                alert(`â„¹ï¸ "${word}" å·²åœ¨å¤ä¹ åˆ—è¡¨ä¸­`);
            }
        }
        
        // å­¦ä¹ ç»Ÿè®¡
        function updateLearningStats() {
            const learnedWords = JSON.parse(localStorage.getItem('learnedWords') || '[]');
            const totalWords = 10;
            const learnedCount = learnedWords.length;
            const progress = Math.round((learnedCount / totalWords) * 100);
            
            // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
            const progressElement = document.querySelector('.stat-card:nth-child(3) .stat-number');
            if (progressElement) {
                progressElement.textContent = learnedCount + 35; // 35æ˜¯åŸºç¡€è¯æ±‡é‡
            }
            
            // æ›´æ–°è¿›åº¦æ¡
            const progressBar = document.querySelector('.progress-indicator');
            if (progressBar) {
                progressBar.style.width = `${progress}%`;
            }
        }
        
        function showLearningStats() {
            const learnedWords = JSON.parse(localStorage.getItem('learnedWords') || '[]');
            const reviewWords = JSON.parse(localStorage.getItem('reviewWords') || '[]');
            const totalWords = 10;
            const learnedCount = learnedWords.length;
            const progress = Math.round((learnedCount / totalWords) * 100);
            
            alert(`ğŸ“Š å­¦ä¹ ç»Ÿè®¡ï¼š
            
ğŸ¯ ä»Šæ—¥è¿›åº¦ï¼š${learnedCount}/${totalWords} (${progress}%)
âœ… å·²å­¦ä¹ ï¼š${learnedWords.join(', ')}
ğŸ”„ å¾…å¤ä¹ ï¼š${reviewWords.length}ä¸ªå•è¯
ğŸ“ˆ æ€»è¯æ±‡é‡ï¼š${learnedCount + 35}ä¸ªæ–°é—»è¯æ±‡

ç»§ç»­åŠ æ²¹ï¼ğŸ’ª`);
        }
        
        function showReviewList() {
            const reviewWords = JSON.parse(localStorage.getItem('reviewWords') || '[]');
            
            if (reviewWords.length === 0) {
                alert('ğŸ”„ å¤ä¹ åˆ—è¡¨ä¸ºç©º\n\næ‰€æœ‰å•è¯éƒ½å·²æŒæ¡ï¼Œå¤ªæ£’äº†ï¼ğŸ‰');
            } else {
                alert(`ğŸ”„ å¤ä¹ åˆ—è¡¨ (${reviewWords.length}ä¸ªå•è¯)ï¼š
                
${reviewWords.map((word, index) => `${index + 1}. ${word}`).join('\n')}

ç‚¹å‡»å•è¯å¡ç‰‡ä¸Šçš„"åŠ å…¥å¤ä¹ "æŒ‰é’®å¯ä»¥æ·»åŠ æ›´å¤šå•è¯åˆ°å¤ä¹ åˆ—è¡¨ã€‚`);
            }
        }
        
        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // æ¢å¤å­¦ä¹ çŠ¶æ€
            const learnedWords = JSON.parse(localStorage.getItem('learnedWords') || '[]');
            learnedWords.forEach(word => {
                const card = document.querySelector(`.word-card:has(.word:contains("${word}"))`);
                if (card) {
                    card.style.opacity = '0.9';
                    card.style.borderColor = '#10b981';
                    
                    const button = card.querySelector('.btn-primary');
                    if (button) {
                        button.innerHTML = 'âœ… å·²å­¦ä¹ ';
                        button.classList.remove('btn-primary');
                        button.classList.add('btn-success');
                        button.disabled = true;
                    }
                }
            });
            
            updateLearningStats();
            
            // æ·»åŠ é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', function(e) {
                // ç©ºæ ¼é”®ï¼šæ’­æ”¾/æš‚åœ
                if (e.code === 'Space' && !e.target.matches('input, textarea')) {
                    e.preventDefault();
                    if (isPlayingAll) {
                        stopAllAudio();
                    } else {
                        playAllWords();
                    }
                }
                
                // ESCé”®ï¼šåœæ­¢æ‰€æœ‰å‘éŸ³
                if (e.code === 'Escape') {
                    stopAllAudio();
                }
                
                // æ•°å­—é”®1-0ï¼šå¿«é€Ÿæ ‡è®°ä¸ºå·²å­¦
                if (e.code >= 'Digit1' && e.code <= 'Digit0' && e.ctrlKey) {
                    const index = e.code === 'Digit0' ? 9 : parseInt(e.code.slice(-1)) - 1;
                    const words = [
                        'election', 'parliament', 'inflation', 'GDP',
                        'inequality', 'reform', 'diplomacy', 'summit',
                        'innovation', 'climate'
                    ];
                    
                    if (words[index]) {
                        // æ¨¡æ‹Ÿç‚¹å‡»æ ‡è®°æŒ‰é’®
                        const card = document.querySelector(`.word-card:has(.word:contains("${words[index]}"))`);
                        const button = card?.querySelector('.btn-primary');
                        if (button) {
                            button.click();
                        }
                    }
                }
            });
            
            // æ·»åŠ è§¦æ‘¸è®¾å¤‡ä¼˜åŒ–
            if ('ontouchstart' in window) {
                document.body.classList.add('touch-device');
                
                // å¢åŠ ç‚¹å‡»åŒºåŸŸ
                const buttons = document.querySelectorAll('.btn, .pronunciation-btn');
                buttons.forEach(btn => {
                    btn.style.minHeight = '44px';
                    btn.style.minWidth = '44px';
                });
            }
            
            console.log('ğŸ“° æ–°é—»è¯æ±‡å­¦ä¹ é¡µé¢åŠ è½½å®Œæˆ');
            console.log('ğŸ’¡ æç¤ºï¼šæŒ‰ç©ºæ ¼é”®æ’­æ”¾/æš‚åœï¼ŒæŒ‰ESCé”®åœæ­¢å‘éŸ³');
        });
        
        // é¡µé¢å¸è½½å‰ä¿å­˜çŠ¶æ€
        window.addEventListener('beforeunload', function() {
            // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ä¿å­˜å­¦ä¹ è¿›åº¦çš„é€»è¾‘
        });
        
        // é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            console.error('é¡µé¢é”™è¯¯:', e.error);
        });
        
        // è¯­éŸ³åˆæˆAPIå¯ç”¨æ€§æ£€æŸ¥
        if (!('speechSynthesis' in window)) {
            console.warn('âš ï¸ æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆAPIï¼Œå‘éŸ³åŠŸèƒ½å°†ä¸å¯ç”¨');
            const buttons = document.querySelectorAll('.pronunciation-btn, .global-btn');
            buttons.forEach(btn => {
                btn.disabled = true;
                btn.title = 'å‘éŸ³åŠŸèƒ½ä¸å¯ç”¨ï¼ˆæµè§ˆå™¨ä¸æ”¯æŒï¼‰';
            });
        }
    </script>
</body>
</html>